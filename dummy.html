import React, { useContext, useState } from "react";
import FormInputs from "../components/FormInputs";
import { store } from "../App";

function FormPage() {
  const { selectedTemplateId } = useContext(store);
  const [formData, setFormData] = useState({
    headerName: "",
    navLinks: "",
    heroHeadline: "",
    heroCTA: "",
    professionalBio: "",
    skills: "",
    personalPhoto: "",
    workItems: [],
    testimonials: [],
    email: "",
    socialLinks: "",
  });

  const handleCreatePortfolio = () => {
    let htmlContent = '';

    // Generate HTML content based on the selected template
    if (selectedTemplateId === 1) {
      htmlContent = `
        <html>
          <head>
            <title>${formData.headerName}'s Portfolio</title>
            <link rel="stylesheet" href="styles.css"> <!-- Add your styles here -->
          </head>
          <body>
            <header>
              <h1>${formData.headerName}</h1>
              <nav>
                <ul>
                  ${formData.navLinks.split(',').map(link => `<li>${link}</li>`).join('')}
                </ul>
              </nav>
            </header>
            <section>
              <h2>${formData.heroHeadline}</h2>
              <p>${formData.heroCTA}</p>
              <img src="${formData.personalPhoto}" alt="Personal Photo" />
            </section>
            <section>
              <h2>About Me</h2>
              <p>${formData.professionalBio}</p>
              <h3>Skills</h3>
              <p>${formData.skills}</p>
            </section>
            <footer>
              <p>Contact: ${formData.email}</p>
              <p>Social Links: ${formData.socialLinks}</p>
            </footer>
          </body>
        </html>
      `;
    } else {
      htmlContent = `
        <html>
          <head>
            <title>${formData.headerName}'s Portfolio</title>
            <link rel="stylesheet" href="styles.css"> <!-- Add your styles here -->
          </head>
          <body style="background-color: #333; color: white;">
            <header>
              <h1>${formData.headerName}</h1>
              <nav>
                <ul>
                  ${formData.navLinks.split(',').map(link => `<li>${link}</li>`).join('')}
                </ul>
              </nav>
            </header>
            <section>
              <h2>${formData.heroHeadline}</h2>
              <p>${formData.heroCTA}</p>
              <img src="${formData.personalPhoto}" alt="Personal Photo" />
            </section>
            <section>
              <h2>About Me</h2>
              <p>${formData.professionalBio}</p>
              <h3>Skills</h3>
              <p>${formData.skills}</p>
            </section>
            <footer>
              <p>Contact: ${formData.email}</p>
              <p>Social Links: ${formData.socialLinks}</p>
            </footer>
          </body>
        </html>
      `;
    }

    // Open in new tab
    const blob = new Blob([htmlContent], { type: "text/html" });
    const url = URL.createObjectURL(blob);
    window.open(url, "_blank");
  };

  return (
    <div className="p-6">
      <h1 className="text-2xl font-bold mb-6">Portfolio Form</h1>
      <FormInputs formData={formData} setFormData={setFormData} />
      <button
        onClick={handleCreatePortfolio}
        className="mt-8 bg-green-600 text-white px-6 py-3 rounded hover:bg-green-700 transition"
      >
        Create Portfolio
      </button>
    </div>
  );
}

export default FormPage;
